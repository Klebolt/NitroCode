<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NitroCode</title>

    <meta property="og:title" content="NitroCode | Control Center">
    <meta property="og:description" content="Solicite seu or√ßamento de desenvolvimento web e automa√ß√£o. Painel administrativo integrado.">
    <meta property="og:image" content="img/logo_oficial_cortado.png">
    <meta property="og:type" content="website">
    
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="data:application/manifest+json;base64,ewogICJuYW1lIjogIk5pdHJvQ29kZSIsCiAgInNob3J0X25hbWUiOiAiTml0cm9Db2RlIiwKICAic3RhcnRfdXJsIjogIi4iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiNmZmZmZmYiLAogICJ0aGVtZV9jb2xvciI6ICIjMDAwMDAwIiwKICAiaWNvbnMiOiBbXQp9">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        /* =========================================
           CONFIGURA√á√ïES VISUAIS
           ========================================= */
        :root {
            --bg-deep: #ffffff;
            --bg-panel: #f8f9fa;
            --bg-panel-hover: #eeeeee;
            --primary: #000000;
            --secondary: #555555;
            --accent: #7E8082; 
            --highlight: #00c853;
            --status-progress: #ff9100;
            --status-replied: #2979ff;
            --status-done: #616161;
            --highlight-email: #d32f2f;
            --border: #e0e0e0;
            --font-ui: 'Outfit', sans-serif;
            --font-tech: 'Space Mono', monospace;
            --logo-filter: invert(1);
        }

        body.dark-mode {
            --bg-deep: #121212;
            --bg-panel: #1e1e1e;
            --bg-panel-hover: #2d2d2d;
            --primary: #ffffff;
            --secondary: #b0b0b0;
            --border: #333333;
            --logo-filter: none;
        }

        html { scroll-behavior: smooth; }
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-deep);
            color: var(--primary);
            font-family: var(--font-ui);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background-image: 
                linear-gradient(rgba(0, 0, 0, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 0, 0, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
            overflow-x: hidden;
            transition: background-color 0.3s, color 0.3s;
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; width: 100%; }
        .hidden { display: none !important; }
        .flex-between { display: flex; justify-content: space-between; align-items: center; }

        /* √çCONES */
        .sys-icon { width: 18px; height: 18px; vertical-align: middle; fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
        .sys-icon.large { width: 32px; height: 32px; }
        .sys-icon.small { width: 14px; height: 14px; }
        .contact-icon { color: var(--accent); margin-right: 8px; }

        /* Anima√ß√µes */
        @keyframes slideInRight { 0% { opacity: 0; transform: translateX(50px); filter: blur(10px); } 100% { opacity: 1; transform: translateX(0); filter: blur(0); } }
        @keyframes zoomBounce { 0% { opacity: 0; transform: scale(0.8); } 60% { opacity: 1; transform: scale(1.05); } 100% { opacity: 1; transform: scale(1); } }
        @keyframes borderPulse { 0% { border-color: var(--highlight); box-shadow: 0 0 0 rgba(0,200,83,0); } 50% { border-color: var(--highlight); box-shadow: 0 0 15px rgba(0,200,83,0.3); } 100% { border-color: var(--highlight); box-shadow: 0 0 0 rgba(0,200,83,0); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes blink { 50% { border-color: transparent; } }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes shake { 0%, 100% {transform: translateX(0);} 25% {transform: translateX(-5px);} 75% {transform: translateX(5px);} }

        .spinner { display: inline-block; width: 16px; height: 16px; border: 2px solid rgba(0,0,0,0.2); border-radius: 50%; border-top-color: var(--primary); animation: spin 0.8s linear infinite; margin-right: 8px; vertical-align: middle; }
        .empty-state { text-align: center; padding: 60px 20px; color: var(--secondary); border: 1px dashed var(--border); border-radius: 12px; grid-column: 1/-1; }
        .empty-icon-container { color: #ccc; margin-bottom: 15px; }

        /* HEADER */
        header { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(12px); border-bottom: 1px solid var(--border); padding: 15px 0; position: sticky; top: 0; z-index: 100; }
        body.dark-mode header { background: rgba(18, 18, 18, 0.9); }
        .logo-img { height: 40px; transition: transform 0.3s; filter: var(--logo-filter); }
        .logo-img:hover { transform: scale(1.05); }
        .header-actions { display: flex; gap: 10px; align-items: center; }
        .btn-lock { background: var(--bg-deep); border: 1px solid var(--border); color: var(--secondary); padding: 8px 12px; border-radius: 6px; font-family: var(--font-tech); font-size: 0.75rem; cursor: pointer; transition: 0.3s; white-space: nowrap; }
        .btn-lock:hover { border-color: var(--primary); color: var(--primary); background: var(--bg-panel); }

        /* CLIENTE */
        .hero-split { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; align-items: center; min-height: 80vh; padding: 40px 0; }
        .hero-text h1 { font-size: clamp(2rem, 5vw, 3.5rem); line-height: 1.1; margin-bottom: 20px; color: var(--primary); min-height: 3.8rem; border-right: 3px solid var(--primary); display: inline-block; animation: blink 0.7s step-end infinite; white-space: pre-wrap; max-width: 100%; word-wrap: break-word; }
        .hero-text p { font-size: 1.1rem; color: var(--secondary); max-width: 450px; margin-bottom: 30px; }
        
        .social-proof { display: flex; align-items: center; gap: 10px; margin-bottom: 30px; font-size: 0.9rem; color: var(--secondary); }
        .stars { color: #FFD700; letter-spacing: 2px; }

        /* Form com Floating Labels */
        .form-card { background: var(--bg-panel); border: 1px solid var(--border); padding: 40px; border-radius: 16px; box-shadow: 0 20px 50px rgba(0,0,0,0.1); backdrop-filter: blur(10px); animation: slideInRight 1s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; animation-delay: 0.5s; opacity: 0; width: 100%; }
        
        /* Chips */
        .chip-group { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 15px; }
        .chip-btn { background: var(--bg-deep); border: 1px solid var(--border); padding: 6px 12px; border-radius: 20px; font-size: 0.75rem; cursor: pointer; transition: 0.2s; color: var(--secondary); font-family: var(--font-tech); }
        .chip-btn:hover { border-color: var(--highlight); color: var(--highlight); }
        .chip-btn:active { transform: scale(0.95); }

        .floating-group { position: relative; margin-bottom: 20px; }
        
        .input-box { width: 100%; background: var(--bg-deep); border: 1px solid #ccc; padding: 20px 15px 8px; color: var(--primary); border-radius: 8px; font-size: 1rem; transition: 0.3s; min-height: 54px; }
        .input-box:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(0,0,0,0.05); background: var(--bg-deep); }
        .input-box.error { border-color: var(--highlight-email); animation: shake 0.3s; background: rgba(211, 47, 47, 0.05); }
        
        .floating-label { 
            position: absolute; top: 50%; left: 15px; transform: translateY(-50%); 
            font-size: 1rem; color: var(--secondary); pointer-events: none; transition: 0.3s; 
            font-family: var(--font-ui); background: transparent; 
        }
        
        .input-box:focus ~ .floating-label,
        .input-box:not(:placeholder-shown) ~ .floating-label {
            top: 10px; transform: translateY(0); font-size: 0.7rem; font-weight: 700; color: var(--primary); text-transform: uppercase; font-family: var(--font-tech);
        }
        
        textarea.input-box { padding-top: 25px; }
        textarea.input-box ~ .floating-label { top: 20px; }
        textarea.input-box:focus ~ .floating-label,
        textarea.input-box:not(:placeholder-shown) ~ .floating-label { top: 10px; }

        .error-msg { display: none; color: var(--highlight-email); font-size: 0.75rem; margin-top: -15px; margin-bottom: 15px; margin-left: 5px; }
        .input-box.error ~ .error-msg { display: block; }

        /* Honeypot */
        .honey-trap { opacity: 0; position: absolute; top: 0; left: 0; height: 0; width: 0; z-index: -1; pointer-events: none; }

        .helper-text { font-size: 0.75rem; color: var(--secondary); margin-top: -15px; margin-bottom: 15px; margin-left: 5px; display: block; }

        .btn-nitro { width: 100%; padding: 16px; background: var(--primary); color: var(--bg-deep); border: none; border-radius: 8px; font-weight: 700; font-size: 1rem; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; transition: 0.2s; display: flex; align-items: center; justify-content: center;}
        .btn-nitro:hover { opacity: 0.9; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .btn-nitro:disabled { background: #ccc; color: #888; cursor: not-allowed; transform: none; box-shadow: none; }
        body.dark-mode .btn-nitro:disabled { background: #333; color: #555; }

        /* ADMIN */
        .admin-bar { background: var(--bg-panel); border-bottom: 1px solid var(--border); padding: 20px 0; margin-bottom: 40px; }
        .admin-tools { display: flex; justify-content: space-between; align-items: center; margin-top: 15px; flex-wrap: wrap; gap: 15px; }
        .filter-group { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
        .filter-btn { background: var(--bg-deep); border: 1px solid var(--border); color: var(--secondary); padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; cursor: pointer; transition: 0.2s; white-space: nowrap; margin-bottom: 5px;}
        .filter-btn:hover { border-color: var(--primary); color: var(--primary); }
        .filter-btn.active { background: var(--primary); color: var(--bg-deep); border-color: var(--primary); font-weight: 700; }
        
        .btn-tool { background: var(--bg-deep); border: 1px solid var(--border); color: var(--primary); padding: 8px 16px; border-radius: 6px; font-size: 0.85rem; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: 0.2s; white-space: nowrap;}
        .btn-tool:hover { background: var(--bg-panel-hover); border-color: var(--secondary); }

        /* Busca */
        .search-container { position: relative; margin-right: 15px; width: auto; }
        .search-input { padding: 8px 12px 8px 35px; border-radius: 20px; border: 1px solid var(--border); background: var(--bg-deep); color: var(--primary); font-family: var(--font-ui); font-size: 0.9rem; width: 200px; transition: 0.3s; }
        .search-input:focus { width: 250px; border-color: var(--primary); outline: none; }
        .search-icon-abs { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); width: 14px; height: 14px; color: var(--secondary); }

        /* KPI */
        .kpi-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .kpi-card { background: var(--bg-panel); border: 1px solid var(--border); padding: 20px; border-radius: 12px; display: flex; flex-direction: column; box-shadow: 0 2px 10px rgba(0,0,0,0.02); }
        .kpi-title { font-size: 0.8rem; text-transform: uppercase; color: var(--secondary); font-weight: 700; letter-spacing: 0.5px; margin-bottom: 5px; }
        .kpi-value { font-size: 2rem; font-weight: 700; color: var(--primary); font-family: var(--font-tech); }
        .kpi-trend { font-size: 0.8rem; margin-top: 5px; color: var(--highlight); display: flex; align-items: center; gap: 5px; }

        /* Feed */
        .feed-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; padding-bottom: 60px; animation: fadeIn 0.5s ease forwards; }
        .feed-container.kanban-mode { display: flex; overflow-x: auto; gap: 20px; align-items: flex-start; padding-bottom: 20px; min-height: 500px; }

        /* Kanban Columns */
        .kanban-column { min-width: 300px; background: var(--bg-panel-hover); border-radius: 12px; padding: 15px; flex-shrink: 0; }
        .kanban-header { font-weight: 700; margin-bottom: 15px; text-transform: uppercase; font-size: 0.8rem; color: var(--secondary); display: flex; align-items: center; gap: 8px; }
        .feed-container.kanban-mode .lead-card { margin-bottom: 15px; }

        .lead-card { background: var(--bg-panel); border: 1px solid var(--border); border-radius: 12px; padding: 25px; position: relative; transition: 0.3s; display: flex; flex-direction: column; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .lead-card:hover { border-color: var(--secondary); transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        
        .status-new { animation: borderPulse 2s infinite; border-color: var(--highlight) !important; background: rgba(0, 200, 83, 0.05); }
        .status-progress { border-color: var(--status-progress) !important; background: rgba(255, 145, 0, 0.05); }
        .status-finished { opacity: 0.7; background: var(--bg-deep); border-color: var(--border) !important; }
        .status-finished:hover { opacity: 1; border-color: var(--secondary) !important; }

        .badge-status { position: absolute; top: -12px; right: 20px; font-weight: 800; font-size: 0.7rem; padding: 6px 12px; border-radius: 20px; text-transform: uppercase; box-shadow: 0 4px 10px rgba(0,0,0,0.1); z-index: 10; display: flex; align-items: center; gap: 6px; color: #fff; }
        .badge-new { background: var(--highlight); }
        .badge-progress { background: var(--status-progress); }
        .badge-replied { background: var(--status-replied); }
        .badge-finished { background: var(--status-done); }

        .status-control { margin-top: 15px; padding-top: 15px; border-top: 1px dashed var(--border); }
        .status-select { width: 100%; background: var(--bg-deep); color: var(--primary); border: 1px solid var(--border); padding: 8px; border-radius: 6px; font-family: var(--font-tech); font-size: 0.8rem; cursor: pointer; }
        .status-select:focus { outline: none; border-color: var(--primary); }

        .lead-header { display: flex; justify-content: space-between; margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 10px; flex-wrap: wrap; gap: 5px;}
        .lead-title { color: var(--primary); font-size: 1.3rem; margin-bottom: 10px; font-weight: 600; word-break: break-word; }
        .lead-desc { color: var(--secondary); font-size: 0.95rem; line-height: 1.6; flex-grow: 1; margin-bottom: 20px; word-break: break-word; }
        .lead-contact { background: var(--bg-deep); padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid var(--border); overflow-wrap: break-word; }
        .contact-item { display: flex; align-items: center; font-size: 0.85rem; color: var(--secondary); margin-bottom: 5px; font-family: var(--font-tech); flex-wrap: wrap; }

        .action-buttons { display: flex; flex-direction: column; gap: 10px; }
        .btn-group-row { display: flex; gap: 10px; }
        .btn-wpp { display: flex; justify-content: center; align-items: center; gap: 8px; width: 100%; background: rgba(37, 211, 102, 0.1); color: #00a852; text-decoration: none; padding: 12px; border-radius: 6px; font-weight: 600; transition: 0.2s; border: 1px solid rgba(37, 211, 102, 0.3); font-size: 0.9rem; }
        .btn-wpp:hover { background: #00a852; color: #fff; }
        .btn-email { display: flex; justify-content: center; align-items: center; gap: 8px; width: 100%; background: rgba(211, 47, 47, 0.1); color: var(--highlight-email); text-decoration: none; padding: 12px; border-radius: 6px; font-weight: 600; transition: 0.2s; border: 1px solid rgba(211, 47, 47, 0.3); font-size: 0.9rem; }
        .btn-email:hover { background: var(--highlight-email); color: #fff; }
        
        .btn-delete, .btn-edit { display: flex; justify-content: center; align-items: center; gap: 8px; width: 100%; background: var(--bg-deep); border: 1px solid var(--border); padding: 10px; border-radius: 6px; cursor: pointer; margin-top: 5px; font-size: 0.8rem; transition: 0.2s; }
        .btn-delete { color: #c62828; border-color: #ffcdd2; }
        .btn-delete:hover { background: #ffebee; border-color: #ef9a9a; }
        .btn-edit { color: var(--primary); }
        .btn-edit:hover { background: var(--bg-panel-hover); }

        body.dark-mode .btn-delete { background: rgba(198, 40, 40, 0.1); border-color: rgba(198, 40, 40, 0.3); color: #ef9a9a; }
        body.dark-mode .btn-delete:hover { background: rgba(198, 40, 40, 0.3); }

        /* Modal e Toast */
        .modal-wrap { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 200; display: flex; justify-content: center; align-items: center; opacity: 0; visibility: hidden; transition: 0.3s; backdrop-filter: blur(5px); padding: 20px; overflow-y: auto; }
        .modal-wrap.active { opacity: 1; visibility: visible; }
        .login-box { background: var(--bg-panel); border: 1px solid var(--border); padding: 30px; border-radius: 12px; text-align: center; width: 100%; max-width: 400px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); }
        .modal-wrap.active .login-box { animation: zoomBounce 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

        .toast-popup { 
            position: fixed; bottom: 30px; right: 30px; 
            background: var(--bg-panel); color: var(--primary); 
            padding: 20px 30px; border-radius: 8px; border-left: 5px solid var(--highlight); 
            display: flex; align-items: center; gap: 15px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); 
            transform: translateY(150%); transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55); 
            z-index: 300; border: 1px solid var(--border); 
            max-width: 90%; 
        }
        .toast-popup.show { transform: translateY(0); animation: borderPulse 2s infinite; }
        
        .modal-actions { display: flex; gap: 10px; justify-content: center; margin-top: 20px; flex-wrap: wrap; }
        .btn-modal-cancel { background: transparent; border: 1px solid var(--border); color: var(--primary); padding: 8px 16px; border-radius: 6px; cursor: pointer; flex: 1; }
        .btn-modal-confirm { background: var(--highlight-email); border: none; color: #fff; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: bold; flex: 1; }
        .btn-modal-save { background: var(--primary); border: none; color: var(--bg-deep); padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: bold; flex: 1; }
        .btn-modal-confirm:hover { background: #b71c1c; }

        .cta-box { display: none; margin-top: 20px; text-align: center; animation: fadeIn 0.5s; background: rgba(0, 200, 83, 0.1); padding: 20px; border-radius: 8px; border: 1px solid var(--highlight); }
        .cta-box.active { display: block; }
        
        .date-tooltip { position: relative; cursor: help; border-bottom: 1px dotted var(--secondary); }

        /* Media Queries */
        @media (max-width: 900px) {
            .hero-split { grid-template-columns: 1fr; gap: 30px; padding-top: 20px; }
            .hero-text { text-align: center; margin-top: 20px; }
            .hero-text h1 { min-height: auto; border-right: none; animation: none; }
            .hero-text p { margin: 0 auto 30px auto; }
            .form-card { padding: 30px; max-width: 600px; margin: 0 auto; }
            .admin-tools { flex-direction: column; align-items: stretch; gap: 15px; }
            .filter-group { flex-wrap: wrap; justify-content: center; }
            .search-container { width: 100%; margin-right: 0; margin-bottom: 10px; }
            .search-input { width: 100%; }
            .search-input:focus { width: 100%; }
            .kpi-container { grid-template-columns: 1fr; }
        }

        @media (max-width: 480px) {
            .container { padding: 0 15px; }
            .logo-img { height: 35px; }
            .btn-lock { padding: 6px 10px; font-size: 0.7rem; }
            .hero-split { padding: 20px 0; }
            .form-card { padding: 20px; }
            .admin-bar { padding: 15px 0; }
            
            .filter-group { justify-content: stretch; overflow-x: visible; flex-wrap: wrap; gap: 10px; }
            .filter-btn { flex: 1 1 45%; text-align: center; margin-bottom: 0; }
            .btn-tool { flex: 1 1 100%; width: 100%; justify-content: center; }
            
            .feed-container { grid-template-columns: 1fr; }
            .lead-card { padding: 20px; }
            .badge-status { right: 15px; top: -10px; font-size: 0.65rem; }
            .toast-popup { bottom: 20px; right: auto; left: 50%; transform: translateX(-50%) translateY(150%); width: 90%; justify-content: center; }
            .toast-popup.show { transform: translateX(-50%) translateY(0); }
        }
    </style>
</head>
<body>

    <header>
        <div class="container flex-between">
            <img src="img/logo_oficial_cortado.png" alt="NitroCode" class="logo-img">
            <div class="header-actions">
                <button class="btn-lock" onclick="toggleTheme()" aria-label="Alternar Tema">
                    <svg class="sys-icon" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                </button>
                <button class="btn-lock" onclick="openLogin()">ADMIN ACCESS</button>
            </div>
        </div>
    </header>

    <main class="container">
        <section id="view-client">
            <div class="hero-split">
                <div class="hero-text">
                    <h1 id="typing-title"></h1>
                    <p>Especialistas em automa√ß√£o e desenvolvimento web de alta performance. Descreva seu problema e receba um or√ßamento t√©cnico.</p>
                    
                    <div class="social-proof">
                        <span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                        <span>Junte-se a 30 empresas inovadoras que j√° escalaram.</span>
                    </div>
                </div>
                <div class="form-card">
                    <form id="clientForm" onsubmit="submitForm(event)">
                        <input type="text" id="website_trap" class="honey-trap" tabindex="-1" autocomplete="off">

                        <div class="floating-group">
                            <input type="text" id="inpName" class="input-box" placeholder=" " required oninput="clearError(this); saveDraft(); checkFormState()" onblur="validateField(this)" autocomplete="name">
                            <label class="floating-label">Nome Completo</label>
                        </div>
                        
                        <div class="floating-group">
                            <input type="tel" id="inpPhone" class="input-box" placeholder=" " oninput="maskPhone(this); clearError(this); saveDraft(); checkFormState()" onblur="validateField(this)" maxlength="15" autocomplete="tel">
                            <label class="floating-label">WhatsApp (Opcional)</label>
                            <span class="error-msg" id="msgPhone">N√∫mero inv√°lido ou curto demais.</span>
                        </div>
                        <span class="helper-text">N√£o enviaremos spam. Promessa de dev.</span>

                        <div class="floating-group">
                            <input type="email" id="inpEmail" class="input-box" placeholder=" " required oninput="clearError(this); saveDraft(); checkFormState()" onblur="validateField(this)" autocomplete="email">
                            <label class="floating-label">E-mail Profissional</label>
                            <span class="error-msg" id="msgEmail">Digite um e-mail v√°lido (ex: nome@empresa.com)</span>
                        </div>

                        <div class="chip-group">
                            <button type="button" class="chip-btn" onclick="fillChip('Site Institucional')">üöÄ Site Institucional</button>
                            <button type="button" class="chip-btn" onclick="fillChip('Automa√ß√£o Python')">ü§ñ Automa√ß√£o</button>
                            <button type="button" class="chip-btn" onclick="fillChip('Landing Page')">üìÑ Landing Page</button>
                            <button type="button" class="chip-btn" onclick="fillChip('Sistema Web')">üíª Sistema Web</button>
                        </div>

                        <div class="floating-group">
                            <input type="text" id="inpTitle" class="input-box" placeholder=" " required oninput="clearError(this); saveDraft(); checkFormState()" onblur="validateField(this)">
                            <label class="floating-label">O que voc√™ precisa?</label>
                        </div>

                        <div class="floating-group">
                            <textarea id="inpDesc" class="input-box" rows="3" placeholder=" " required oninput="clearError(this); saveDraft(); checkFormState()" onblur="validateField(this)"></textarea>
                            <label class="floating-label">Detalhes (DETALHE A SUA SOLICITA√á√ÉO)</label>
                        </div>

                        <button type="submit" id="btnSubmit" class="btn-nitro" disabled>Receber Proposta T√©cnica</button>
                    </form>
                    
                    <div id="ctaBox" class="cta-box">
                        <div style="background: rgba(255,255,255,0.5); padding: 10px; border-radius: 6px; margin-bottom: 15px; border: 1px dashed var(--highlight);">
                            <small style="text-transform: uppercase; letter-spacing: 1px; font-weight: 700;">Seu Protocolo</small>
                            <div id="successCode" style="font-family: var(--font-tech); font-size: 1.8rem; font-weight: 700; color: var(--primary);">#---</div>
                        </div>
                    
                        <h3 style="margin-bottom:10px; color:var(--primary);">Recebemos seu contato!</h3>
                        <p style="color:var(--secondary); margin-bottom:15px; font-size:0.9rem;">
                            Sua solicita√ß√£o foi registrada. Um e-mail de confirma√ß√£o foi enviado.
                        </p>
                    
                        <button onclick="resetClientView()" style="background:none; border:none; text-decoration:underline; color:var(--secondary); margin-top:15px; cursor:pointer;">Enviar outro</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="view-admin" class="hidden">
            <div class="admin-bar">
                <div class="container">
                    <div class="flex-between">
                        <h2 style="font-weight: 400;">Painel de Controle</h2>
                        <button onclick="logout()" style="background:none; border:none; color:var(--secondary); cursor:pointer;">Sair</button>
                    </div>
                    
                    <div class="admin-tools">
                        <div class="filter-group">
                            <div class="search-container">
                                <svg class="sys-icon search-icon-abs" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                                <input type="text" id="searchInput" class="search-input" placeholder="Buscar lead..." oninput="renderAdmin()" aria-label="Buscar Leads">
                            </div>
                            
                            <button class="filter-btn active" onclick="setFilter('all')" id="filter-all">Todos</button>
                            <button class="filter-btn" onclick="setFilter('new')" id="filter-new">Novos</button>
                            <button class="filter-btn" onclick="setFilter('progress')" id="filter-progress">Andamento</button>
                            <button class="filter-btn" onclick="setFilter('finished')" id="filter-finished">Finalizados</button>
                        </div>
                        
                        <div class="filter-group">
                            <button class="btn-tool" onclick="toggleViewMode()" id="btnViewMode">
                                <svg class="sys-icon" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
                                Kanban
                            </button>
                            <button class="btn-tool" onclick="exportBackup()">
                                <svg class="sys-icon" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                                Backup
                            </button>
                            <button class="btn-tool" onclick="document.getElementById('importInput').click()">
                                <svg class="sys-icon" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                                Restaurar
                            </button>
                            <input type="file" id="importInput" style="display:none" onchange="importBackup(this)" accept=".json">
                        </div>
                    </div>
                </div>
            </div>

            <div class="kpi-container">
                <div class="kpi-card">
                    <div class="kpi-title">Total de Leads</div>
                    <div class="kpi-value" id="kpi-total">0</div>
                    <div class="kpi-trend">Base Completa</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-title" style="color:var(--highlight)">Novas Solicita√ß√µes</div>
                    <div class="kpi-value" id="kpi-new">0</div>
                    <div class="kpi-trend"><svg class="sys-icon small" viewBox="0 0 24 24"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg> Aguardando a√ß√£o</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-title" style="color:var(--status-done)">Finalizados</div>
                    <div class="kpi-value" id="kpi-done">0</div>
                    <div class="kpi-trend">Taxa de convers√£o</div>
                </div>
            </div>

            <div id="feed" class="feed-container"></div>
        </section>
    </main>

    <div id="modalLogin" class="modal-wrap">
        <div class="login-box">
            <h3 style="margin-bottom:20px; color:var(--primary);">Autentica√ß√£o</h3>
            <input type="password" id="passInput" class="input-box" placeholder="Senha" style="text-align:center;">
            <button class="btn-nitro" id="btnLoginBtn" onclick="checkPass()">Entrar</button>
            <button onclick="closeLogin()" style="background:none; border:none; color:var(--secondary); margin-top:15px; cursor:pointer;">Cancelar</button>
        </div>
    </div>

    <div id="modalConfirm" class="modal-wrap">
        <div class="login-box">
            <h3 style="color:var(--highlight-email); margin-bottom: 10px;">Excluir Lead?</h3>
            <p style="color:var(--secondary); margin-bottom: 20px;">Esta a√ß√£o n√£o pode ser desfeita. Tem certeza que deseja remover este registro permanentemente?</p>
            <div class="modal-actions">
                <button class="btn-modal-cancel" onclick="closeConfirm()">Cancelar</button>
                <button class="btn-modal-confirm" onclick="executeDelete()">Sim, Excluir</button>
            </div>
        </div>
    </div>

    <div id="modalEdit" class="modal-wrap">
        <div class="login-box">
            <h3 style="color:var(--primary); margin-bottom: 20px;">Editar Lead</h3>
            <input type="hidden" id="editId">
            <div style="text-align:left;">
                <label class="form-label">Nome</label><input type="text" id="editName" class="input-box">
                <label class="form-label">Email</label><input type="email" id="editEmail" class="input-box">
                <label class="form-label">Telefone</label><input type="text" id="editPhone" class="input-box" oninput="maskPhone(this)">
                <label class="form-label">T√≠tulo</label><input type="text" id="editTitle" class="input-box">
                <label class="form-label">Descri√ß√£o</label><textarea id="editDesc" class="input-box" rows="3"></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn-modal-cancel" onclick="closeEdit()">Cancelar</button>
                <button class="btn-modal-save" onclick="saveEdit()">Salvar Altera√ß√µes</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast-popup">
        <svg class="sys-icon large" style="color:var(--highlight)" viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
        <div><strong style="display:block; color:var(--primary);">Recebido!</strong><span style="font-size:0.9rem; color:var(--secondary);">Sua solicita√ß√£o foi enviada com sucesso.</span></div>
    </div>

    <script>
        // --- CONFIGURA√á√ÉO DO SUPABASE (PROTEGIDO) ---
        const supabaseUrl = 'https://lfiwvfpgksyxphehgbba.supabase.co'; 
        const supabaseKey = 'sb_publishable_ADPJ3hPXXFZuPnObON9UQA_0OJPk1lY';
        
        let supabaseClient = null;
        try {
            // Tenta conectar. Se a URL estiver errada/placeholder, pode dar erro, 
            // mas o try/catch impede que o site todo trave.
            if(supabaseUrl !== 'https://lfiwvfpgksyxphehgbba.supabase.co') {
                supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);
            }
        } catch(e) {
            console.warn("Supabase ainda n√£o configurado ou URL inv√°lida.");
        }
        // -----------------------------------------------------------

        const ICONS = {
            lightning: `<svg class="sys-icon small" viewBox="0 0 24 24"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>`,
            gear: `<svg class="sys-icon small" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>`,
            reply: `<svg class="sys-icon small" viewBox="0 0 24 24"><polyline points="9 14 4 9 9 4"></polyline><path d="M20 20v-7a4 4 0 0 0-4-4H4"></path></svg>`,
            check: `<svg class="sys-icon small" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>`,
            whatsapp: `<svg class="sys-icon" viewBox="0 0 24 24"><rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect><line x1="12" y1="18" x2="12.01" y2="18"></line></svg>`,
            mail: `<svg class="sys-icon" viewBox="0 0 24 24"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>`,
            empty: `<svg class="sys-icon" style="width:64px;height:64px;" viewBox="0 0 24 24"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>`
        };

        let savedData = localStorage.getItem('nitroCodeLeads');
        let posts = savedData ? JSON.parse(savedData) : [];
        
        let currentFilter = 'all';
        let viewMode = 'list'; // list ou kanban
        let pendingDeleteId = null; 
        let loginAttempts = 0;
        let lockoutTimer = null;

        function saveToLocal() { localStorage.setItem('nitroCodeLeads', JSON.stringify(posts)); }
        function escapeHtml(text) { if (!text) return text; return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;"); }
        
        // Time Ago Logic
        function timeAgo(dateString) {
            try {
                // Formato esperado: "DD/MM/YYYY √†s HH:MM"
                const [datePart, timePart] = dateString.split(' √†s ');
                const [day, month, year] = datePart.split('/');
                const [hour, min] = timePart.split(':');
                
                const postDate = new Date(year, month - 1, day, hour, min);
                const now = new Date();
                const diffInSeconds = Math.floor((now - postDate) / 1000);

                if (diffInSeconds < 60) return "Agora mesmo";
                const diffInMinutes = Math.floor(diffInSeconds / 60);
                if (diffInMinutes < 60) return `H√° ${diffInMinutes} min`;
                const diffInHours = Math.floor(diffInMinutes / 60);
                if (diffInHours < 24) return `H√° ${diffInHours} horas`;
                const diffInDays = Math.floor(diffInHours / 24);
                if (diffInDays === 1) return "Ontem";
                if (diffInDays < 30) return `H√° ${diffInDays} dias`;
                return datePart; 
            } catch (e) {
                return dateString;
            }
        }

        // Typing Effect Corrigido
        const textToType = "Sua ideia,\nNosso C√≥digo.";
        const typingElement = document.getElementById('typing-title');
        let charIndex = 0;
        
        function typeWriter() {
            if (charIndex < textToType.length) {
                const char = textToType.charAt(charIndex);
                if(char === '\n') {
                    typingElement.innerHTML += '<br>';
                } else {
                    typingElement.innerHTML += char;
                }
                charIndex++;
                setTimeout(typeWriter, 100);
            }
        }

        window.onload = function() {
            typeWriter();
            if ("Notification" in window) Notification.requestPermission();
            
            // --- CONFIGURA√á√ÉO EMAILJS ---
            emailjs.init("RY4GTflUtBf95qiNl"); 

            // Draft Load
            loadDraft();

            if(sessionStorage.getItem('nitroAuth') === 'true') {
                document.getElementById('view-client').classList.add('hidden');
                document.getElementById('view-admin').classList.remove('hidden');
                renderAdmin();
            }
            if(localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');
        };

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
        }

        function toggleViewMode() {
            viewMode = viewMode === 'list' ? 'kanban' : 'list';
            renderAdmin();
        }

        function maskPhone(input) {
            let v = input.value;
            if (v.startsWith('+')) {
                v = v.replace(/[^\d+ -]/g, "");
            } else {
                v = v.replace(/\D/g, "");
                v = v.replace(/^(\d{2})(\d)/g, "($1) $2");
                v = v.replace(/(\d)(\d{4})$/, "$1-$2");
            }
            input.value = v;
        }

        // Chip Logic
        function fillChip(val) {
            const input = document.getElementById('inpTitle');
            input.value = val;
            checkFormState(); // Atualiza bot√£o
            saveDraft();
        }

        // Draft Logic
        function saveDraft() {
            const draft = {
                name: document.getElementById('inpName').value,
                phone: document.getElementById('inpPhone').value,
                email: document.getElementById('inpEmail').value,
                title: document.getElementById('inpTitle').value,
                desc: document.getElementById('inpDesc').value
            };
            localStorage.setItem('clientDraft', JSON.stringify(draft));
        }

        function loadDraft() {
            const draft = JSON.parse(localStorage.getItem('clientDraft'));
            if(draft) {
                document.getElementById('inpName').value = draft.name || '';
                document.getElementById('inpPhone').value = draft.phone || '';
                document.getElementById('inpEmail').value = draft.email || '';
                document.getElementById('inpTitle').value = draft.title || '';
                document.getElementById('inpDesc').value = draft.desc || '';
                checkFormState(); 
            }
        }

        function clearDraft() {
            localStorage.removeItem('clientDraft');
        }

        // Auth
        function openLogin() { document.getElementById('modalLogin').classList.add('active'); document.getElementById('passInput').value = ''; setTimeout(() => document.getElementById('passInput').focus(), 100); }
        function closeLogin() { document.getElementById('modalLogin').classList.remove('active'); }
        
        // CORRE√á√ÉO LOGIN: Removida criptografia para funcionar em qualquer ambiente
        function checkPass() {
            const btnLogin = document.getElementById('btnLoginBtn');
            const inputPass = document.getElementById('passInput');
            if (lockoutTimer) return;
            
            // Senha simples 'admin' para garantir acesso imediato
            if(inputPass.value === 'admin') {
                sessionStorage.setItem('nitroAuth', 'true');
                loginAttempts = 0; closeLogin();
                document.getElementById('view-client').classList.add('hidden');
                document.getElementById('view-admin').classList.remove('hidden');
                renderAdmin();
            } else {
                loginAttempts++;
                const box = document.querySelector('.login-box');
                box.style.transform = 'translateX(10px)';
                setTimeout(() => box.style.transform = 'translateX(-10px)', 100);
                setTimeout(() => box.style.transform = 'translateX(0)', 200);
                if (loginAttempts >= 3) {
                    lockoutTimer = true; btnLogin.disabled = true; btnLogin.style.background = '#666'; let timeLeft = 30;
                    const interval = setInterval(() => {
                        btnLogin.innerText = `Aguarde ${timeLeft}s`; timeLeft--;
                        if(timeLeft < 0) { clearInterval(interval); lockoutTimer = null; loginAttempts = 0; btnLogin.disabled = false; btnLogin.style.background = ''; btnLogin.innerText = 'Entrar'; }
                    }, 1000);
                }
            }
        }
        function logout() { sessionStorage.removeItem('nitroAuth'); document.getElementById('view-admin').classList.add('hidden'); document.getElementById('view-client').classList.remove('hidden'); }

        // Client Form Logic
        function validateField(input) {
            const val = input.value.trim();
            if(val === '') return; 

            let isValid = true;
            if(input.type === 'email') {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                isValid = emailRegex.test(val);
            }
            if(input.id === 'inpPhone') {
                isValid = val.length >= 8; 
            }

            if(!isValid) {
                input.classList.add('error');
            } else {
                input.classList.remove('error');
            }
        }

        function clearError(input) {
            input.classList.remove('error');
        }

        function checkFormState() {
            const name = document.getElementById('inpName').value.trim();
            const emailInp = document.getElementById('inpEmail').value.trim();
            const title = document.getElementById('inpTitle').value.trim();
            const desc = document.getElementById('inpDesc').value.trim();
            
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            const isEmailValid = emailRegex.test(emailInp);
            
            const isValid = name && isEmailValid && title && desc;
            document.getElementById('btnSubmit').disabled = !isValid;
        }

        function valForm() { checkFormState(); }

        function submitForm(e) {
            e.preventDefault();
            
            if(document.getElementById('website_trap').value !== '') {
                console.log("Spam detected.");
                return; 
            }

            const btn = document.getElementById('btnSubmit');
            btn.innerHTML = '<span class="spinner"></span> Enviando...';
            const tempName = document.getElementById('inpName').value;
            const tempTitle = document.getElementById('inpTitle').value;
            const tempDesc = document.getElementById('inpDesc').value;
            const tempEmail = document.getElementById('inpEmail').value;
            const tempPhone = document.getElementById('inpPhone').value;

            const shortCode = Math.random().toString(36).substring(2, 8).toUpperCase();
            const formattedCode = `#NC-${shortCode}`;

            const emailParams = {
                to_email: tempEmail,
                to_name: tempName,
                protocol_code: formattedCode,
                project_title: tempTitle,
                project_desc: tempDesc,
            };

            emailjs.send("service_18xd16e", "template_9um4181", emailParams)
                .then(function(response) {
                    console.log('EMAILJS SUCCESS!', response.status, response.text);
                }, function(error) {
                    console.log('EMAILJS FAILED...', error);
                });

            setTimeout(() => {
                const newPost = {
                    id: Date.now(),
                    shortId: formattedCode, 
                    user: tempName,
                    date: new Date().toLocaleString('pt-BR', { dateStyle: 'short', timeStyle: 'short' }),
                    phone: tempPhone,
                    email: tempEmail,
                    title: tempTitle,
                    desc: tempDesc,
                    status: 'new',
                    logs: [{date: new Date().toLocaleString(), msg: `Lead criado. Protocolo: ${formattedCode}`}]
                };
                posts.unshift(newPost);
                saveToLocal();
                clearDraft();
                
                if (Notification.permission === "granted") {
                    new Notification(`Novo Lead: ${formattedCode}`, { body: `${tempName} solicitou: ${tempTitle}`, icon: "img/logo_oficial_cortado.png" });
                }

                document.getElementById('clientForm').reset();
                document.getElementById('clientForm').style.display = 'none';
                
                const ctaBox = document.getElementById('ctaBox');
                
                // Exibe o protocolo
                document.getElementById('successCode').innerText = formattedCode;

                // Contatos removidos conforme solicitado!

                ctaBox.classList.add('active');
                
                btn.innerHTML = 'Receber Proposta T√©cnica';
            }, 1500);
        }

        function resetClientView() {
            document.getElementById('clientForm').style.display = 'block';
            document.getElementById('ctaBox').classList.remove('active');
        }

        // Admin Logic
        function changeStatus(id, newStatus) {
            const post = posts.find(p => p.id === id);
            if(post) {
                post.status = newStatus;
                if(!post.logs) post.logs = [];
                post.logs.push({date: new Date().toLocaleString(), msg: `Status alterado para ${newStatus}`});
                saveToLocal();
                renderAdmin();
            }
        }

        function deletePost(id) { pendingDeleteId = id; document.getElementById('modalConfirm').classList.add('active'); }
        function closeConfirm() { document.getElementById('modalConfirm').classList.remove('active'); pendingDeleteId = null; }
        function executeDelete() {
            if (pendingDeleteId) {
                posts = posts.filter(p => p.id !== pendingDeleteId);
                saveToLocal(); renderAdmin(); closeConfirm();
                showToast("Exclu√≠do!", "Lead removido com sucesso.");
            }
        }

        // Edit Logic
        function openEdit(id) {
            const post = posts.find(p => p.id === id);
            if(post) {
                document.getElementById('editId').value = post.id;
                document.getElementById('editName').value = post.user;
                document.getElementById('editEmail').value = post.email;
                document.getElementById('editPhone').value = post.phone;
                document.getElementById('editTitle').value = post.title;
                document.getElementById('editDesc').value = post.desc;
                document.getElementById('modalEdit').classList.add('active');
            }
        }
        function closeEdit() { document.getElementById('modalEdit').classList.remove('active'); }
        function saveEdit() {
            const id = parseInt(document.getElementById('editId').value);
            const post = posts.find(p => p.id === id);
            if(post) {
                post.user = document.getElementById('editName').value;
                post.email = document.getElementById('editEmail').value;
                post.phone = document.getElementById('editPhone').value;
                post.title = document.getElementById('editTitle').value;
                post.desc = document.getElementById('editDesc').value;
                if(!post.logs) post.logs = [];
                post.logs.push({date: new Date().toLocaleString(), msg: `Dados editados`});
                saveToLocal();
                closeEdit();
                renderAdmin();
                showToast("Sucesso!", "Dados atualizados.");
            }
        }

        // Backup Logic
        function exportBackup() {
            if(posts.length === 0) { alert("Sem dados."); return; }
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(posts));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "nitrocode_backup.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }
        function importBackup(input) {
            const file = input.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    if(Array.isArray(imported)) {
                        posts = imported;
                        saveToLocal();
                        renderAdmin();
                        showToast("Restaurado!", "Backup importado com sucesso.");
                    } else { alert("Arquivo inv√°lido."); }
                } catch(err) { alert("Erro ao ler arquivo."); }
            };
            reader.readAsText(file);
        }

        function setFilter(filterType) {
            currentFilter = filterType;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`filter-${filterType}`).classList.add('active');
            renderAdmin();
        }

        function showToast(title, msg) {
            const toast = document.getElementById('toast');
            toast.innerHTML = `<div><strong style="display:block; color:var(--primary);">${title}</strong><span style="font-size:0.9rem; color:var(--secondary);">${msg}</span></div>`;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function copyId(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast("Copiado!", "Protocolo copiado para a √°rea de transfer√™ncia.");
            });
        }

        function createCardHTML(p) {
            const safeUser = escapeHtml(p.user);
            const safeTitle = escapeHtml(p.title);
            const safeDesc = escapeHtml(p.desc);
            const relativeDate = timeAgo(p.date);
            
            const displayId = p.shortId ? p.shortId : `#OLD-${p.id.toString().slice(-4)}`;

            const mailSubject = encodeURIComponent(`NitroCode: Or√ßamento para ${p.title} (${displayId})`);
            const mailBody = encodeURIComponent(`Ol√° ${p.user},\n\nRecebemos sua solicita√ß√£o sobre "${p.title}" na NitroCode.\nProtocolo: ${displayId}\n\nGostar√≠amos de entender melhor sua necessidade para enviar uma proposta t√©cnica.\n\nAtenciosamente,\nEquipe NitroCode.`);
            const gmailLink = `https://mail.google.com/mail/?view=cm&fs=1&to=${p.email}&su=${mailSubject}&body=${mailBody}`;

            let whatsappButtonHTML = '';
            if(p.phone && p.phone.trim() !== '') {
                const cleanPhone = p.phone.replace(/\D/g,'');
                const wppUrl = `https://wa.me/55${cleanPhone}?text=Ol√° ${encodeURIComponent(p.user)}, vi sua solicita√ß√£o na NitroCode (Protocolo: ${displayId}).`;
                whatsappButtonHTML = `<a href="${wppUrl}" target="_blank" class="btn-wpp">${ICONS.whatsapp} WhatsApp</a>`;
            }

            let cardClass = '', badgeHtml = '';
            switch(p.status) {
                case 'new': cardClass = 'status-new'; badgeHtml = `<div class="badge-status badge-new">${ICONS.lightning} NOVO</div>`; break;
                case 'progress': cardClass = 'status-progress'; badgeHtml = `<div class="badge-status badge-progress">${ICONS.gear} ANDAMENTO</div>`; break;
                case 'replied': badgeHtml = `<div class="badge-status badge-replied">${ICONS.reply} RESPONDIDO</div>`; break;
                case 'finished': cardClass = 'status-finished'; badgeHtml = `<div class="badge-status badge-finished">${ICONS.check} FIM</div>`; break;
            }

            return `
                <div class="lead-card ${cardClass}">
                    ${badgeHtml}
                    <div class="lead-header">
                        <div>
                            <span onclick="copyId('${displayId}')" title="Clique para copiar" style="cursor:pointer; font-family:var(--font-tech); font-size:0.7rem; background:var(--bg-panel-hover); padding:2px 6px; border-radius:4px; border:1px solid var(--border); color:var(--secondary); transition:0.2s;">${displayId} <svg class="sys-icon small" style="width:10px;height:10px;vertical-align:middle;margin-left:2px" viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></span>
                            <div style="font-weight:700; color:var(--primary); margin-top:4px;">${safeUser}</div>
                            <div class="date-tooltip" title="${p.date}" style="font-size:0.8rem; color:var(--secondary); font-family:var(--font-tech)">${relativeDate}</div>
                        </div>
                    </div>
                    <div class="lead-title">${safeTitle}</div>
                    <div class="lead-desc">${safeDesc}</div>
                    <div class="lead-contact">
                        <div class="contact-item"><span class="contact-icon">${ICONS.mail}</span> ${escapeHtml(p.email)}</div>
                        <div class="contact-item"><span class="contact-icon">${ICONS.whatsapp}</span> ${p.phone ? escapeHtml(p.phone) : '-'}</div>
                    </div>
                    <div class="action-buttons">
                        <div class="btn-group-row">
                            ${whatsappButtonHTML}
                            <a href="${gmailLink}" target="_blank" class="btn-email">${ICONS.mail} Gmail</a>
                        </div>
                        <div class="btn-group-row">
                            <button onclick="openEdit(${p.id})" class="btn-edit">
                                <svg class="sys-icon small" viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                                Editar
                            </button>
                            <button onclick="deletePost(${p.id})" class="btn-delete" aria-label="Excluir">
                                <svg class="sys-icon small" viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                                Excluir
                            </button>
                        </div>
                    </div>
                    <div class="status-control">
                        <select class="status-select" onchange="changeStatus(${p.id}, this.value)">
                            <option value="new" ${p.status === 'new' ? 'selected' : ''}>‚ö° Novo Lead</option>
                            <option value="replied" ${p.status === 'replied' ? 'selected' : ''}>‚Ü©Ô∏è J√° Respondido</option>
                            <option value="progress" ${p.status === 'progress' ? 'selected' : ''}>‚öôÔ∏è Em Andamento</option>
                            <option value="finished" ${p.status === 'finished' ? 'selected' : ''}>‚úÖ Finalizado</option>
                        </select>
                    </div>
                </div>
            `;
        }

        function updateKPIs() {
            document.getElementById('kpi-total').textContent = posts.length;
            document.getElementById('kpi-new').textContent = posts.filter(p => p.status === 'new').length;
            document.getElementById('kpi-done').textContent = posts.filter(p => p.status === 'finished').length;
        }

        function renderAdmin() {
            updateKPIs();
            const feed = document.getElementById('feed');
            feed.innerHTML = '';
            
            let filtered = posts;
            if(currentFilter !== 'all') filtered = posts.filter(p => p.status === currentFilter);
            const term = document.getElementById('searchInput').value.toLowerCase();
            if(term) {
                filtered = filtered.filter(p => 
                    p.user.toLowerCase().includes(term) || 
                    p.title.toLowerCase().includes(term) ||
                    (p.shortId && p.shortId.toLowerCase().includes(term))
                );
            }

            if(viewMode === 'kanban') {
                feed.classList.add('kanban-mode');
                const cols = {
                    'new': { title: 'Novos', items: [] },
                    'progress': { title: 'Em Andamento', items: [] },
                    'replied': { title: 'Respondidos', items: [] },
                    'finished': { title: 'Finalizados', items: [] }
                };
                filtered.forEach(p => { if(cols[p.status]) cols[p.status].items.push(p); });

                Object.keys(cols).forEach(key => {
                    const col = cols[key];
                    let itemsHtml = col.items.map(p => createCardHTML(p)).join('');
                    feed.innerHTML += `
                        <div class="kanban-column">
                            <div class="kanban-header">${col.title} (${col.items.length})</div>
                            ${itemsHtml}
                        </div>
                    `;
                });
            } else {
                feed.classList.remove('kanban-mode');
                if(filtered.length === 0) {
                    feed.innerHTML = `<div style="grid-column: 1/-1;" class="empty-state"><div class="empty-icon-container">${ICONS.empty}</div><p>Nada encontrado.</p></div>`;
                } else {
                    filtered.forEach(p => feed.innerHTML += createCardHTML(p));
                }
            }
        }
        
        document.getElementById('passInput').addEventListener('keypress', (e) => { if(e.key === 'Enter') checkPass(); });
    </script>
</body>
</html>
